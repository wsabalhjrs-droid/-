---
sidebar_label: With ngrok Agents
title: Global Load Balancing for Agents
description: Learn how ngrok's Global Load Balancer improves the resiliency of your ngrok agents, agent SDKs and the Kubernetes Controller.
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";
import { LangSwitcher } from "@site/src/components/LangSwitcher";

import ExplicitRegionAgentConfigExample from "/examples/agent-config/explicit-region.mdx";
import ExplicitRegionKubernetesExample from "/examples/k8s/explicit-region.mdx";

ngrok's GSLB automatically improves the performance and resiliency of your
ngrok agents, agent SDKs and the Kubernetes Controller. Agents automatically
connect to ngrok's geographically-closest healthy point of presence.

## Acceleration

Similar to endpoints, when an ngrok agent connects, DNS resolution returns the IPs of the closest ngrok point of presence. Connecting to the closest ngrok point of presence reduces agent initialization time and also reduces the latency of connections that are routed to that agent.

## Losing a Point of Presence

If an ngrok point of presence fails, health checks automatically detect that
failure and update our DNS resolution such that agents will attempt to connect to the next-closest healthy point of presence.

The ngrok agent connects to a single region at a time. If you want the ngrok
agent to simultaneously connect to multiple regions, you must instead run
multiple ngrok agents and [explicitly disable agent
GSLB](#disabling-gslb-in-the-agent).

## Disabling GSLB in the Agent

You should always prefer to allow the ngrok agent to use GSLB and connect to
the closest point of presence. However, the ngrok agent does support disabling
GSLB and explicitly choosing which point of presence to connect to.

If you wish to configure the agent to use a specific point of presence you may
do so with the following configuration:

<Tabs groupId="endpoint-type" queryString="ept">
	<TabItem value="agent-" label="Agent Endpoint">

<LangSwitcher>
```bash
ngrok http 80 --region eu
```

```ssh tabName="SSH"
ssh -R 0:localhost:80 connect.eu.ngrok-agent.com http
```

```go
import (
	"context"
	"net"

	"golang.ngrok.com/ngrok"
	"golang.ngrok.com/ngrok/config"
)

func ngrokListener(ctx context.Context) (net.Listener, error) {
	return ngrok.Listen(ctx,
		config.HTTPEndpoint(),
		ngrok.WithRegion("eu"),
		ngrok.WithAuthtokenFromEnv(),
	)
}
```

```jsx
const ngrok = require("@ngrok/ngrok");

(async function () {
	const session = await new ngrok.SessionBuilder()
		.authtokenFromEnv()
		.serverAddr("connect.eu.ngrok-agent.com:443")
		.connect();

	const listener = await session
		.httpEndpoint()
		.listenAndForward("http://localhost:8080");

	console.log(`Ingress established at: ${listener.url()}`);
})();
```

```python
import ngrok, asyncio

async def create_listener() -> ngrok.Listener:
    session: ngrok.Session = (
        await ngrok.SessionBuilder()
        .authtoken_from_env()
        .server_addr("connect.eu.ngrok-agent.com:443")
        .connect()
    )

    return (await session.http_endpoint()
        .listen_and_forward("http://localhost:8080"))

listener = asyncio.run(create_listener())

print(f"Ingress established at: {listener.url()}");
```

```rust
use ngrok::prelude::*;

async fn listen_ngrok() -> anyhow::Result<impl Tunnel> {
    let sess = ngrok::Session::builder()
        .authtoken_from_env()
        .server_addr("connect.eu.ngrok-agent.com:443"),
        .connect()
        .await?;

    let tun = sess
        .http_endpoint()
        .listen()
        .await?;

    println!("Listening on URL: {:?}", tun.url());

    Ok(tun)
}
```

</LangSwitcher>

    </TabItem>
    <TabItem value="agent-config" label="Agent Config" default>
    	<ExplicitRegionAgentConfigExample />
    </TabItem>
    <TabItem value="k8s" label="Kubernetes Controller">
    	<ExplicitRegionKubernetesExample />
    </TabItem>

</Tabs>

## Legacy Agent Behavior

Beginning with the [ngrok v3 agent](/agent/changelog#ngrok-agent-300---2022-03-28), the agent uses GSLB to connect to the lowest-latency point point of presence. Prior to that, v2 ngrok agents would always connect to the US region by default.
